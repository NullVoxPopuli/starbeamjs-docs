import{_ as u,r as e,o as i,c as r,d as a,w as o,e as c,a as n,b as s}from"./app.2b56bc34.js";const k={},d=c(`<h1 id="resources" tabindex="-1"><a class="header-anchor" href="#resources" aria-hidden="true">#</a> Resources</h1><p>A resource is a reactive computation that needs to be cleaned up when it is no longer used.</p><p>Resources are created with an owner, and whenever the owner is cleaned up, the resource is also cleaned up. This is called <em>ownership linking</em>.</p><p>Typically, a component in your framework will own your resources. The framework renderer will make sure that when your component is <em>unmounted</em>, its associated resources are cleaned up.</p><h2 id="example-ticking-stopwatch" tabindex="-1"><a class="header-anchor" href="#example-ticking-stopwatch" aria-hidden="true">#</a> Example: Ticking Stopwatch</h2><p>Let&#39;s illustrate the idea of a resource by creating a stopwatch that uses a <code>setInterval</code> to tick. By using a Starbeam resource, we can ensure that the stopwatch is stopped when the owner is cleaned up.</p><section class="both-lang"><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Cell<span class="token punctuation">,</span> Resource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@starbeam/core&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Stopwatch <span class="token operator">=</span> <span class="token function">Resource</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">Cell</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    time<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  r<span class="token punctuation">.</span>on<span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> now <span class="token operator">=</span> time<span class="token punctuation">.</span>current<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Intl</span><span class="token punctuation">.</span><span class="token function">DateTimeFormat</span><span class="token punctuation">(</span><span class="token string">&quot;en-US&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      hour<span class="token operator">:</span> <span class="token string">&quot;numeric&quot;</span><span class="token punctuation">,</span>
      minute<span class="token operator">:</span> <span class="token string">&quot;numeric&quot;</span><span class="token punctuation">,</span>
      second<span class="token operator">:</span> <span class="token string">&quot;numeric&quot;</span><span class="token punctuation">,</span>
      hour12<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></section><div class="lightbulb"><p>A resource&#39;s return value is a function that computes the value of the resource whenever its dependencies change.</p></div><h3 id="demo-rendering-the-stopwatch" tabindex="-1"><a class="header-anchor" href="#demo-rendering-the-stopwatch" aria-hidden="true">#</a> <strong class="marker">demo</strong> rendering the stopwatch</h3>`,9),m=n("div",{class:"language-html ext-html line-numbers-mode"},[n("pre",{class:"language-html"},[n("code",null,[n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("p")]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("output"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("p")]),n("span",{class:"token punctuation"},">")]),s(`
`),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"<"),s("button")]),s(),n("span",{class:"token attr-name"},"id"),n("span",{class:"token attr-value"},[n("span",{class:"token punctuation attr-equals"},"="),n("span",{class:"token punctuation"},'"'),s("finalize"),n("span",{class:"token punctuation"},'"')]),n("span",{class:"token punctuation"},">")]),s("Finalize the Stopwatch"),n("span",{class:"token tag"},[n("span",{class:"token tag"},[n("span",{class:"token punctuation"},"</"),s("button")]),n("span",{class:"token punctuation"},">")]),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=n("div",{class:"language-javascript ext-js line-numbers-mode"},[n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" button "),n("span",{class:"token operator"},"="),s(" document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"#finalize"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(" output "),n("span",{class:"token operator"},"="),s(" document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"#output"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" Cell"),n("span",{class:"token punctuation"},","),s(" Resource"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"TIMELINE"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token constant"},"LIFETIME"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(`
    `),n("span",{class:"token keyword"},"await"),s(),n("span",{class:"token keyword"},"import"),n("span",{class:"token punctuation"},"("),s(`
      `),n("span",{class:"token string"},'"https://assets.codepen.io/1630871/starbeam.js"'),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token keyword"},"const"),s(" Stopwatch "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"Resource"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"r"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" time "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"Cell"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Date"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" interval "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"setInterval"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      time`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Date"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    r`),n("span",{class:"token punctuation"},"."),s("on"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"cleanup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"clearInterval"),n("span",{class:"token punctuation"},"("),s("interval"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" now "),n("span",{class:"token operator"},"="),s(" time"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},[s("Intl"),n("span",{class:"token punctuation"},"."),s("DateTimeFormat")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"en-US"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token literal-property property"},"hour"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},'"numeric"'),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token literal-property property"},"minute"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},'"numeric"'),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token literal-property property"},"second"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},'"numeric"'),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token literal-property property"},"hour12"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"format"),n("span",{class:"token punctuation"},"("),s("now"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token comment"},"// Instantiate the Stopwatch with an owner. We will"),s(`
  `),n("span",{class:"token comment"},"// later finalize the owner to clean up the resource."),s(`
  `),n("span",{class:"token comment"},"// In this case, that will clear the interval and"),s(`
  `),n("span",{class:"token comment"},"// stop the watch from ticking."),s(`
  `),n("span",{class:"token keyword"},"const"),s(" owner "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" stopwatch "),n("span",{class:"token operator"},"="),s(" Stopwatch"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"create"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    owner`),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token comment"},"// Render the stopwatch into the DOM. The `render`"),s(`
  `),n("span",{class:"token comment"},"// callback will be called whenever the stopwatch's"),s(`
  `),n("span",{class:"token comment"},"// value changes."),s(`
  `),n("span",{class:"token comment"},"//"),s(`
  `),n("span",{class:"token comment"},"// In this case, that will happen whenever the `time`"),s(`
  `),n("span",{class:"token comment"},"// cell in the resource is set."),s(`
  `),n("span",{class:"token constant"},"TIMELINE"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),s("stopwatch"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    output`),n("span",{class:"token punctuation"},"."),s("innerHTML "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"The current time is: "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("stopwatch"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token comment"},"// After 3 seconds, finalize the owner to stop the stopwatch."),s(`
  button`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),s(`
    `),n("span",{class:"token string"},'"click"'),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token constant"},"LIFETIME"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"finalize"),n("span",{class:"token punctuation"},"("),s("owner"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token number"},"3000"),s(`
  `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),v=n("h2",{id:"lifecycle",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#lifecycle","aria-hidden":"true"},"#"),s(" Lifecycle")],-1),b=n("p",null,"Let's take a look at an example of a resource that receives messages on a channel, and returns a string representing the last message it received.",-1),w=n("div",{class:"custom-container note"},[n("p",{class:"custom-container-title"},"Note"),n("p",null,[s("In this example, the channel name that we're subscribing to is dynamic, and we want to unsubscribe from the channel whenever the channel name changes, but "),n("em",null,"not"),s(" when we get a new message.")])],-1),g=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"ChannelResource"),n("span",{class:"token punctuation"},"("),s(`
  channelName`),n("span",{class:"token operator"},":"),s(" Reactive"),n("span",{class:"token operator"},"<"),n("span",{class:"token builtin"},"string"),n("span",{class:"token operator"},">"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(" ResourceConstructor"),n("span",{class:"token operator"},"<"),n("span",{class:"token builtin"},"string"),n("span",{class:"token operator"},">"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"Resource"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("resource"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" channel "),n("span",{class:"token operator"},"="),s(" Channel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"subscribe"),n("span",{class:"token punctuation"},"("),s("channelName"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    resource`),n("span",{class:"token punctuation"},"."),s("on"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"cleanup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" channel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unsubscribe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" lastMessage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"Cell"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),s(),n("span",{class:"token keyword"},"as"),s(),n("span",{class:"token builtin"},"string"),s(),n("span",{class:"token operator"},"|"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"onMessage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      lastMessage`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" prefix "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"["),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("channelName"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"] "),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("lastMessage"),n("span",{class:"token punctuation"},"."),s("current "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("prefix"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," No messages received yet"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token comment"},"/*E1*/"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("prefix"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("lastMessage"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"declare"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Channel"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token function"},"subscribe"),n("span",{class:"token punctuation"},"("),s("name"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(" Channel"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token function"},"onMessage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function-variable function"},"handler"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"void"),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"void"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token function"},"unsubscribe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"void"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),C=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"ChannelResource"),n("span",{class:"token punctuation"},"("),s("channelName"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"Resource"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("resource"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" channel "),n("span",{class:"token operator"},"="),s(" Channel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"subscribe"),n("span",{class:"token punctuation"},"("),s("channelName"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    resource`),n("span",{class:"token punctuation"},"."),s("on"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"cleanup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" channel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"unsubscribe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"const"),s(" lastMessage "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"Cell"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"onMessage"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      lastMessage`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" prefix "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"["),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("channelName"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"] "),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("lastMessage"),n("span",{class:"token punctuation"},"."),s("current "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("prefix"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," No messages received yet"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token comment"},"/*E1*/"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("prefix"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("lastMessage"),n("span",{class:"token punctuation"},"."),s("current"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),f=n("p",null,[n("code",null,"ChannelResource"),s(" is a JavaScript function that takes the channel name as a reactive input and returns a resource constructor.")],-1),A=n("p",null,[s("That resource constructor starts by subscribing to the current value of the "),n("code",null,"channelName"),s(", and then telling starbeam to unsubscribe from the channel when the resource is cleaned up.")],-1),y=n("p",null,"It then creates a cell that holds the last message it received on the channel, and returns a function that returns that message as a formatted string (or a helpful message if the channel hasn't received any messages yet).",-1),D=n("p",null,"At this point, let's take a look at the dependencies:",-1),B=n("p",null,[s("Our output depends on the channel name and the last message received on that channel. The "),n("code",null,"lastMessage"),s(" depends on the channel name as well, and whenever the channel name changes, the resource is cleaned up and the channel is unsubscribed.")],-1),_=n("p",null,[n("strong",null,"If we receive a new message"),s(", the "),n("code",null,"lastMessage"),s(" cell is set to the new message. This invalidates "),n("code",null,"lastMessage"),s(" and therefore the output as well.")],-1),E=n("p",null,[s("However, this does "),n("strong",null,"not"),s(" invalidate the resource itself, so the channel subscription remains active.")],-1),F=n("p",null,[s("On the other hand, "),n("strong",null,[s("if we change the "),n("code",null,"channelName")]),s(", that invalidates the "),n("code",null,"ChannelResource"),s(" itself.")],-1),M=c('<p>As a result, the resource will be cleaned up and the channel unsubscribed. After that, the resource will be re-created from the new <code>channelName</code>, and the process will continue.</p><blockquote class="em"><p>From the perspective of the creator of a resource, the resource represents a stable reactive value.</p></blockquote><details class="custom-container details"><summary>Under the Hood</summary><p>Under the hood, the internal <code>ChannelResource</code> instance is cleaned up and recreated whenever <strong>its</strong> inputs change. However, the resource you got back when you <code>create</code>d it remains the same.</p><p>That&#39;s what makes it possible to pass a resource to <code>TIMELINE.render</code> and have it continue to work even when the internal resource is torn down and recreated.</p></details>',3);function I(x,N){const p=e("CodeDemo"),l=e("Code"),t=e("Mermaid");return i(),r("div",null,[d,a(p,{id:"code-demo-f4ac5358",type:"normal",code:"%7B%22html%22%3A%22%3Cp%20id%3D%5C%22output%5C%22%3E%3C%2Fp%3E%5Cn%3Cbutton%20id%3D%5C%22finalize%5C%22%3EFinalize%20the%20Stopwatch%3C%2Fbutton%3E%5Cn%22%2C%22js%22%3A%22const%20button%20%3D%20document.querySelector(%5C%22%23finalize%5C%22)%3B%5Cnconst%20output%20%3D%20document.querySelector(%5C%22%23output%5C%22)%3B%5Cn%5Cnasync%20function%20main()%20%7B%5Cn%20%20const%20%7B%20Cell%2C%20Resource%2C%20TIMELINE%2C%20LIFETIME%20%7D%20%3D%5Cn%20%20%20%20await%20import(%5Cn%20%20%20%20%20%20%5C%22https%3A%2F%2Fassets.codepen.io%2F1630871%2Fstarbeam.js%5C%22%5Cn%20%20%20%20)%3B%5Cn%5Cn%20%20const%20Stopwatch%20%3D%20Resource((r)%20%3D%3E%20%7B%5Cn%20%20%20%20const%20time%20%3D%20Cell(new%20Date())%3B%5Cn%5Cn%20%20%20%20const%20interval%20%3D%20setInterval(()%20%3D%3E%20%7B%5Cn%20%20%20%20%20%20time.set(new%20Date())%3B%5Cn%20%20%20%20%7D%2C%201000)%3B%5Cn%5Cn%20%20%20%20r.on.cleanup(()%20%3D%3E%20clearInterval(interval))%3B%5Cn%5Cn%20%20%20%20return%20()%20%3D%3E%20%7B%5Cn%20%20%20%20%20%20const%20now%20%3D%20time.current%3B%5Cn%5Cn%20%20%20%20%20%20return%20new%20Intl.DateTimeFormat(%5C%22en-US%5C%22%2C%20%7B%5Cn%20%20%20%20%20%20%20%20hour%3A%20%5C%22numeric%5C%22%2C%5Cn%20%20%20%20%20%20%20%20minute%3A%20%5C%22numeric%5C%22%2C%5Cn%20%20%20%20%20%20%20%20second%3A%20%5C%22numeric%5C%22%2C%5Cn%20%20%20%20%20%20%20%20hour12%3A%20false%2C%5Cn%20%20%20%20%20%20%7D).format(now)%3B%5Cn%20%20%20%20%7D%3B%5Cn%20%20%7D)%3B%5Cn%5Cn%20%20%2F%2F%20Instantiate%20the%20Stopwatch%20with%20an%20owner.%20We%20will%5Cn%20%20%2F%2F%20later%20finalize%20the%20owner%20to%20clean%20up%20the%20resource.%5Cn%20%20%2F%2F%20In%20this%20case%2C%20that%20will%20clear%20the%20interval%20and%5Cn%20%20%2F%2F%20stop%20the%20watch%20from%20ticking.%5Cn%20%20const%20owner%20%3D%20%7B%7D%3B%5Cn%20%20const%20stopwatch%20%3D%20Stopwatch.create(%7B%5Cn%20%20%20%20owner%2C%5Cn%20%20%7D)%3B%5Cn%5Cn%20%20%2F%2F%20Render%20the%20stopwatch%20into%20the%20DOM.%20The%20%60render%60%5Cn%20%20%2F%2F%20callback%20will%20be%20called%20whenever%20the%20stopwatch's%5Cn%20%20%2F%2F%20value%20changes.%5Cn%20%20%2F%2F%5Cn%20%20%2F%2F%20In%20this%20case%2C%20that%20will%20happen%20whenever%20the%20%60time%60%5Cn%20%20%2F%2F%20cell%20in%20the%20resource%20is%20set.%5Cn%20%20TIMELINE.render(stopwatch%2C%20()%20%3D%3E%20%7B%5Cn%20%20%20%20output.innerHTML%20%3D%20%60The%20current%20time%20is%3A%20%24%7Bstopwatch.current%7D%60%3B%5Cn%20%20%7D)%3B%5Cn%5Cn%20%20%2F%2F%20After%203%20seconds%2C%20finalize%20the%20owner%20to%20stop%20the%20stopwatch.%5Cn%20%20button.addEventListener(%5Cn%20%20%20%20%5C%22click%5C%22%2C%5Cn%20%20%20%20()%20%3D%3E%20%7B%5Cn%20%20%20%20%20%20LIFETIME.finalize(owner)%3B%5Cn%20%20%20%20%7D%2C%5Cn%20%20%20%203000%5Cn%20%20)%3B%5Cn%7D%5Cn%5Cnmain()%3B%5Cn%22%7D"},{default:o(()=>[m,h]),_:1}),v,b,w,a(l,null,{ts:o(()=>[g]),js:o(()=>[C]),_:1}),f,A,y,D,a(t,{id:"mermaid-382ee1c6",code:"%25%25%7Binit%3A%20%7B%22theme%22%3A%22neutral%22%2C%22themeVariables%22%3A%7B%22fontSize%22%3A%220.75rem%22%2C%22fontFamily%22%3A%22Azeret%20Mono%22%7D%2C%22flowchart%22%3A%7B%22curve%22%3A%22linear%22%7D%2C%22themeCSS%22%3A%22*%20%7B%20box-sizing%3A%20border-box%20%7D%22%7D%7D%25%25%0Aflowchart%20BT%0A%20%20resource%3A%3A%3Achart-resource%0A%20%20%0A%20%20channelName%0A%20%20subgraph%20resource%20%5BChannelResource%5D%0A%20%20lastMessage%0A%20%20end%0A%20%20resource%20--%3E%20channelName%0A%20%20Output%20--%3E%20channelName%0A%20%20Output%20--%3E%20lastMessage%0A%20%20"}),B,_,a(t,{id:"mermaid-382ee1e2",code:"%25%25%7Binit%3A%20%7B%22theme%22%3A%22neutral%22%2C%22themeVariables%22%3A%7B%22fontSize%22%3A%220.75rem%22%2C%22fontFamily%22%3A%22Azeret%20Mono%22%7D%2C%22flowchart%22%3A%7B%22curve%22%3A%22linear%22%7D%2C%22themeCSS%22%3A%22*%20%7B%20box-sizing%3A%20border-box%20%7D%22%7D%7D%25%25%0Aflowchart%20BT%0A%20%20resource%3A%3A%3Achart-resource%0A%20%20%0A%20%20channelName%0A%20%20subgraph%20resource%20%5BChannelResource%5D%0A%20%20lastMessage%3A%3A%3Ainvalidated%0A%20%20end%0A%20%20Output%3A%3A%3Ainvalidated%0A%20%20resource%0A%20%20resource%20--%3E%20channelName%0A%20%20Output%20--%3E%20channelName%0A%20%20Output%20--%3E%20lastMessage%0A%20%20"}),E,F,a(t,{id:"mermaid-382ee1e9",code:"%25%25%7Binit%3A%20%7B%22theme%22%3A%22neutral%22%2C%22themeVariables%22%3A%7B%22fontSize%22%3A%220.75rem%22%2C%22fontFamily%22%3A%22Azeret%20Mono%22%7D%2C%22flowchart%22%3A%7B%22curve%22%3A%22linear%22%7D%2C%22themeCSS%22%3A%22*%20%7B%20box-sizing%3A%20border-box%20%7D%22%7D%7D%25%25%0Aflowchart%20BT%0A%20%20resource%3A%3A%3Achart-resource%0A%20%20classDef%20default%20font-family%3Amonospace%0A%20%20%0A%20%20channelName%3A%3A%3Ainvalidated%0A%20%20subgraph%20resource%20%5BChannelResource%5D%0A%20%20%20%20lastMessage%3A%3A%3Ainactive%0A%20%20end%0A%20%20Output%3A%3A%3Ainactive%0A%20%20resource%3A%3A%3Ainvalidated%0A%20%20resource%20--%3E%20channelName%0A%20%20Output%20--%3E%20channelName%0A%20%20Output%20--%3E%20lastMessage%0A%20%20"}),M])}var S=u(k,[["render",I],["__file","4-resources.html.vue"]]);export{S as default};
